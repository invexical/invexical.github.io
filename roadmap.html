<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invexic Trainer | Passion Project</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&family=Balthazar&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* --- GLOBAL VARIABLES (CUSTOM 8-TIER PALETTE) --- */
        :root {
            --bg-dark: #050505;
            --bg-card: #0f0f0f;
            --bg-hover: #161616;
            --border: #222;
            
            /* 8-TIER DIFFICULTY LEGEND */
            --d-veasy: #60A5FA;   /* 0-10: Light Blue */
            --d-easy: #2DD4BF;    /* 11-20: Turquoise */
            --d-easymed: #A3E635; /* 21-35: Lime Green */
            --d-med: #FACC15;     /* 36-50: Yellow */
            --d-medhard: #FB923C; /* 51-65: Orange */
            --d-hard: #FFAB91;    /* 66-80: Peach */
            --d-vhard: #EF4444;   /* 81-90: Red */
            --d-extreme: #EC4899; /* 91+: Pink */

            --text-main: #f0f0f0;
            --text-muted: #888;
        }

        * { box-sizing: border-box; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow-x: hidden;
        }

        /* --- AMBIENT BACKGROUND --- */
        body::before {
            content: '';
            position: fixed;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle at center, rgba(96, 165, 250, 0.04), transparent 50%);
            z-index: -1;
            animation: rotateBg 120s linear infinite;
            pointer-events: none;
        }
        @keyframes rotateBg { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- NAVIGATION --- */
        nav {
            border-bottom: 1px solid var(--border);
            background: rgba(5, 5, 5, 0.85);
            backdrop-filter: blur(12px);
            position: sticky; top: 0; z-index: 100;
        }
        .nav-content {
            max-width: 1400px; margin: 0 auto; padding: 15px 24px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .brand { font-family: 'Balthazar', serif; font-size: 1.6rem; color: #fff; font-weight: bold; letter-spacing: -0.5px; }
        .brand span { color: var(--d-easy); }
        
        .nav-links { display: flex; gap: 20px; align-items: center; }
        .nav-btn {
            background: none; border: none; color: var(--text-muted);
            cursor: pointer; font-size: 0.95rem; font-weight: 600;
            transition: 0.2s;
        }
        .nav-btn:hover { color: white; }
        
        .user-pill {
            background: var(--bg-hover);
            border: 1px solid var(--border);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex; align-items: center; gap: 8px;
            cursor: pointer; transition: 0.2s;
        }
        .user-pill:hover { border-color: #444; background: #222; }
        .xp-text { color: var(--d-med); font-weight: 700; font-family: 'JetBrains Mono', monospace; }

        /* --- LAYOUTS --- */
        .view-section { display: none; padding: 40px 24px; max-width: 1400px; margin: 0 auto; }
        .view-section.active { display: block; }

        /* --- GUIDE VIEW --- */
        .guide-container { display: grid; grid-template-columns: 280px 1fr; gap: 50px; }
        @media(max-width: 850px) { .guide-container { grid-template-columns: 1fr; } }

        /* Sidebar */
        .guide-sidebar { 
            position: sticky; top: 100px; height: fit-content; 
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 16px; padding: 24px;
        }
        .guide-section-title {
            font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.2px;
            color: #555; margin: 24px 0 12px 0; font-weight: 800;
        }
        .guide-section-title:first-child { margin-top: 0; }
        
        .guide-nav-item {
            padding: 10px 14px; color: #aaa; cursor: pointer;
            border-radius: 8px; transition: 0.2s; font-size: 0.95rem; font-weight: 500;
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;
        }
        .guide-nav-item:hover { background: var(--bg-hover); color: white; }
        .guide-nav-item.active { background: rgba(255,255,255,0.05); color: white; font-weight: 600; }
        .count-badge { font-size: 0.7rem; background: #222; padding: 3px 8px; border-radius: 4px; color: #777; font-family: 'JetBrains Mono', monospace; }

        /* Content Styling */
        .topic-section { margin-bottom: 60px; scroll-margin-top: 100px; }
        .topic-header { 
            font-size: 1.8rem; margin-bottom: 25px; border-bottom: 1px solid var(--border); 
            padding-bottom: 15px; display: flex; align-items: center; gap: 15px; font-weight: 700; 
            letter-spacing: -0.5px;
        }
        .topic-icon { color: var(--d-easy); }
        
        /* --- COOL TRAINER PROBLEM LIST --- */
        .problem-list { display: flex; flex-direction: column; gap: 12px; }
        
        .problem-row {
            display: grid;
            /* Status | Title | Tags | Diff | Arrow */
            grid-template-columns: 40px 1fr 1.5fr 110px 40px;
            align-items: center;
            background: var(--bg-card);
            border: 1px solid var(--border);
            /* The Glow Border (Left side) */
            border-left: 4px solid transparent; 
            padding: 18px 24px;
            border-radius: 10px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        /* Hover Effects */
        .problem-row:hover {
            transform: translateY(-2px) translateX(4px);
            background: var(--bg-hover);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.3);
        }

        /* Mobile tweaks */
        @media(max-width: 700px) {
            .problem-row { grid-template-columns: 30px 1fr 30px; padding: 16px; }
            .prob-tags-col, .diff-badge { display: none; } 
        }

        /* --- DYNAMIC DIFFICULTY CLASSES (8 TIERS) --- */
        
        /* 1. Very Easy (Light Blue) */
        .row-veasy { border-left-color: var(--d-veasy); }
        .row-veasy:hover { box-shadow: 0 0 15px rgba(96, 165, 250, 0.15); border-color: var(--d-veasy); }
        .badge-veasy { color: var(--d-veasy); border-color: rgba(96, 165, 250, 0.3); background: rgba(96, 165, 250, 0.1); }
        
        /* 2. Easy (Turquoise) */
        .row-easy { border-left-color: var(--d-easy); }
        .row-easy:hover { box-shadow: 0 0 15px rgba(45, 212, 191, 0.15); border-color: var(--d-easy); }
        .badge-easy { color: var(--d-easy); border-color: rgba(45, 212, 191, 0.3); background: rgba(45, 212, 191, 0.1); }

        /* 3. Easy-Med (Lime Green) */
        .row-easymed { border-left-color: var(--d-easymed); }
        .row-easymed:hover { box-shadow: 0 0 15px rgba(163, 230, 53, 0.15); border-color: var(--d-easymed); }
        .badge-easymed { color: var(--d-easymed); border-color: rgba(163, 230, 53, 0.3); background: rgba(163, 230, 53, 0.1); }

        /* 4. Medium (Yellow) */
        .row-med { border-left-color: var(--d-med); }
        .row-med:hover { box-shadow: 0 0 15px rgba(250, 204, 21, 0.15); border-color: var(--d-med); }
        .badge-med { color: var(--d-med); border-color: rgba(250, 204, 21, 0.3); background: rgba(250, 204, 21, 0.1); }

        /* 5. Med-Hard (Orange) */
        .row-medhard { border-left-color: var(--d-medhard); }
        .row-medhard:hover { box-shadow: 0 0 15px rgba(251, 146, 60, 0.15); border-color: var(--d-medhard); }
        .badge-medhard { color: var(--d-medhard); border-color: rgba(251, 146, 60, 0.3); background: rgba(251, 146, 60, 0.1); }

        /* 6. Hard (Peach) */
        .row-hard { border-left-color: var(--d-hard); }
        .row-hard:hover { box-shadow: 0 0 15px rgba(255, 171, 145, 0.15); border-color: var(--d-hard); }
        .badge-hard { color: var(--d-hard); border-color: rgba(255, 171, 145, 0.3); background: rgba(255, 171, 145, 0.1); }

        /* 7. V. Hard (Red) */
        .row-vhard { border-left-color: var(--d-vhard); }
        .row-vhard:hover { box-shadow: 0 0 15px rgba(239, 68, 68, 0.15); border-color: var(--d-vhard); }
        .badge-vhard { color: var(--d-vhard); border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.1); }

        /* 8. Extreme (Pink) */
        .row-extreme { border-left-color: var(--d-extreme); }
        .row-extreme:hover { box-shadow: 0 0 15px rgba(236, 72, 153, 0.15); border-color: var(--d-extreme); }
        .badge-extreme { color: var(--d-extreme); border-color: rgba(236, 72, 153, 0.3); background: rgba(236, 72, 153, 0.1); }


        /* Row Contents */
        .status-icon { color: #333; display: flex; justify-content: center; }
        .status-icon.solved { color: var(--d-easy); filter: drop-shadow(0 0 5px rgba(45, 212, 191, 0.5)); }
        
        .prob-info { display: flex; flex-direction: column; gap: 6px; }
        .prob-title { font-weight: 700; color: var(--text-main); font-size: 1.1rem; }
        
        .prob-tags-col { display: flex; gap: 8px; flex-wrap: wrap; }
        .mini-tag { 
            font-size: 0.75rem; color: #999; background: rgba(255,255,255,0.05); 
            padding: 4px 8px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.1); 
            font-weight: 500;
        }

        /* Difficulty Badges */
        .diff-badge {
            font-size: 0.75rem; padding: 4px 10px; border-radius: 20px;
            text-align: center; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;
            width: fit-content; justify-self: center; border: 1px solid transparent; background: #222;
        }

        /* --- PROBLEM DETAIL OVERLAY --- */
        .detail-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(15px);
            z-index: 2000; display: flex; justify-content: center; align-items: flex-start;
            overflow-y: auto; padding: 40px 20px;
        }
        .detail-overlay.hidden { display: none; }
        
        .detail-container {
            background: #0a0a0a; width: 100%; max-width: 950px;
            border-radius: 24px; border: 1px solid var(--border);
            padding: 40px; margin: auto 0; position: relative;
            box-shadow: 0 40px 100px rgba(0,0,0,0.8);
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes slideUp { from { transform: translateY(40px) scale(0.98); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        
        .close-btn { 
            position: absolute; top: 20px; right: 20px; 
            background: transparent; border: 1px solid var(--border); color: #666; 
            width: 40px; height: 40px; border-radius: 50%; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .close-btn:hover { border-color: #fff; color: #fff; background: #222; }

        .question-header { 
            display: flex; justify-content: space-between; align-items: flex-start; 
            margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 25px; 
        }
        .question-box { font-family: 'Balthazar', serif; font-size: 1.4rem; margin-bottom: 40px; line-height: 1.6; color: #eee; }
        
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; margin-bottom: 50px; }
        .opt-box {
            background: #141414; padding: 18px; border-radius: 12px; border: 1px solid #333;
            cursor: pointer; display: flex; gap: 12px; align-items: center; justify-content: center;
            transition: 0.2s; font-size: 1.1rem; font-weight: 500;
        }
        .opt-box:hover:not(.disabled) { border-color: var(--d-med); background: #1a1a1a; transform: translateY(-3px); }
        .opt-box.correct { background: rgba(45, 212, 191, 0.15); border-color: var(--d-easy); color: var(--d-easy); }
        .opt-box.incorrect { background: rgba(239, 68, 68, 0.15); border-color: var(--d-vhard); color: var(--d-vhard); }
        .opt-box.disabled { cursor: default; opacity: 0.8; }
        
        /* Analysis Dashboard */
        .analysis-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; border-top: 1px solid var(--border); padding-top: 40px; }
        .info-card { background: #111; border: 1px solid var(--border); padding: 24px; border-radius: 16px; }
        .info-card h4 { color: #777; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; font-weight: 800; }
        .trap-card { border-color: rgba(239, 68, 68, 0.2); background: rgba(239, 68, 68, 0.05); }
        .trap-card h4 { color: var(--d-vhard); }
    </style>
</head>
<body>

    <!-- NAV -->
    <nav>
        <div class="nav-content">
            <div class="brand">invexic<span>.trainer</span></div>
            <div class="nav-links">
                <button class="nav-btn active" onclick="switchView('guide')">Curriculum</button>
                <div class="user-pill">
                    <i data-lucide="trophy" size="14" color="#FACC15"></i>
                    <span id="userXp" class="xp-text">0 XP</span>
                </div>
                <div class="user-pill" id="loginBtn">
                    <i data-lucide="user" size="14"></i>
                    <span id="loginText">Guest</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- VIEW: GUIDE -->
    <div id="guideView" class="view-section active">
        <div class="guide-container">
            <!-- Sidebar -->
            <div class="guide-sidebar">
                <div class="guide-section-title">Core Curriculum</div>
                <div class="guide-nav-item active" onclick="scrollToTopic('algebra')">
                    <span>Algebra & Number Theory</span>
                    <span class="count-badge">7</span>
                </div>
                <div class="guide-nav-item" onclick="scrollToTopic('geometry')">
                    <span>Geometry</span>
                    <span class="count-badge">4</span>
                </div>
                <div class="guide-nav-item" onclick="scrollToTopic('combo')">
                    <span>Combinatorics & Logic</span>
                    <span class="count-badge">2</span>
                </div>
                
                <div class="guide-section-title">Difficulty Legend</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px;">
                    <div class="diff-badge badge-veasy">Very Easy</div>
                    <div class="diff-badge badge-easy">Easy</div>
                    <div class="diff-badge badge-easymed">Easy-Med</div>
                    <div class="diff-badge badge-med">Medium</div>
                    <div class="diff-badge badge-medhard">Med-Hard</div>
                    <div class="diff-badge badge-hard">Hard</div>
                    <div class="diff-badge badge-vhard">V. Hard</div>
                    <div class="diff-badge badge-extreme">Extreme</div>
                </div>

                <div class="guide-section-title">Your Stats</div>
                <div style="padding: 10px; color: #888; font-size: 0.9rem;">
                    Problems Solved: <span id="solvedCount" style="color: white; font-weight: bold;">0</span>/13
                </div>
            </div>

            <!-- Content -->
            <div class="guide-content" id="guideContent">
                <!-- Injected via JS -->
            </div>
        </div>
    </div>

    <!-- PROBLEM MODAL -->
    <div id="detailOverlay" class="detail-overlay hidden">
        <div class="detail-container">
            <button class="close-btn" onclick="closeDetail()"><i data-lucide="x"></i></button>
            <div id="detailContent"></div>
        </div>
    </div>

    <!-- FIRESTORE LOGIC & RENDER -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // --- GLOBAL VARIABLES ---
        let app, auth, db;
        let currentUser = null;
        let solvedProblems = new Set();
        let currentXP = 0;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app';

        // --- PROBLEM DATA ---
        const problems = [
    {
        id: "AMC10A_2025_P1",
        contest: "AMC 10A 2025",
        problemNumber: 1,
        difficulty: 6, // Scale 0-100
        answerIndex: 4,
        idealTime: { // Time in seconds
            beginner: 90, 
            intermediate: 40,
            experienced: 20
        },
        category: "Algebra",
        tags: ["Rate", "Distance-Rate-Time", "Equation Setup", "Relative Motion"],
        coreIdeas: "Accounting for Betsy's 1-hour delay.",
        nonObviousTransitions: "N/A",
        techniques: "Distance-rate-time setup. Algebraic substitution.",
        errorProneSteps: "Failing to account for the one hour delay.",
        solution: "Andy and Betsy both live in Mathville. Andy leaves Mathville on his bicycle at $1{:}30$ traveling due north at a steady $8$ miles per hour. Betsy leaves at $2{:}30$, traveling due east at a steady $12$ miles per hour. At what time will they be exactly the same distance from their starting point?",
        options: [
            "3:30 PM",
            "3:45 PM",
            "4:00 PM",
            "4:15 PM",
            "4:30 PM"
        ]
    },
    {
        id: "AMC10A_2025_P2",
        contest: "AMC 10A 2025",
        problemNumber: 2,
        difficulty: 9,
        answerIndex: 1,
        idealTime: { 
            beginner: 60, 
            intermediate: 30,
            experienced: 20
        },
        category: "Algebra",
        tags: ["Mixtures", "Weighted Mean", "Percentages", "System of Equations"],
        coreIdeas: "Using weighted means properly. Knowing how to traverse the information given in the problem, and ignoring unimportant info.",
        nonObviousTransitions: "N/A",
        techniques: "Set up a linear equation for the second mixture's weight.",
        errorProneSteps: "Finding the number of pounds of the second mixture and thinking that is the answer.",
        solution: "A box contains $10$ pounds of a nut mix that is $50\%$ peanuts, $20\%$ cashews, and $30\%$ almonds. A second nut mix containing $20\%$ peanuts, $40\%$ cashews, and $40\%$ almonds is added to the box resulting in a new nut mix that is $40\%$ peanuts. How many pounds of cashews are now in the box?",
        options: [
            "3.5",
            "4",
            "4.5",
            "5",
            "6"
        ]
    },
    {
        id: "AMC10A_2025_P3",
        contest: "AMC 10A 2025",
        problemNumber: 3,
        difficulty: 14,
        answerIndex: 3,
        idealTime: { 
            beginner: 90, 
            intermediate: 45,
            experienced: 25
        },
        category: "Algebra, Geometry, and Combinatorics",
        tags: ["Casework", "Triangle Inequality", "Isosceles Triangle", "Counting"],
        coreIdeas: "Realizing that the longest side being $2025$ results in two scenarios.",
        nonObviousTransitions: "Realizing the need for two cases based on which side is repeated.",
        techniques: "Solve inequalities for both cases, avoid double-counting equilateral triangle.",
        errorProneSteps: "Forgetting or double-counting equilateral case.",
        solution: "How many isosceles triangles are there with positive area whose side lengths are all positive integers and whose longest side has length $2025$?",
        options: [
            "2025",
            "2026",
            "3012",
            "3037",
            "4050"
        ]
    },
    {
        id: "AMC10A_2025_P4",
        contest: "AMC 10A 2025",
        problemNumber: 4,
        difficulty: 26,
        answerIndex: 1,
        idealTime: { 
            beginner: 180, 
            intermediate: 120,
            experienced: 60
        },
        category: "Algebra",
        tags: ["Mean", "Average", "System of Equations", "Word Problem"],
        coreIdeas: "Dealing with the change in means by finding the change in the total sum.",
        nonObviousTransitions: "N/A",
        techniques: "Use sums and averages, set up system with three unknowns.",
        errorProneSteps: "Setting up equations incorrectly (for example, forgetting that Ash adds one person to the team).",
        solution: "A team of students is going to compete against a team of teachers in a trivia contest. The total number of students and teachers is $15$. Ash wants to join. If Ash plays with the students, the average age increases from $12$ to $14$. If Ash plays with the teachers, the average age decreases from $55$ to $52$. How old is Ash?",
        options: [
            "28",
            "29",
            "30",
            "31",
            "32"
        ]
    },

    {
        id: "AMC10A_2025_P5",
        contest: "AMC 10A 2025",
        problemNumber: 5,
        difficulty: 30,
        answerIndex: 4,
        idealTime: { 
            beginner: 180, 
            intermediate: 60,
            experienced: 35
        },
        category: "Algebra",
        tags: ["Sequences", "Arithmetic Progression", "Triangular Numbers"],
        coreIdeas: "Finding the endpoints of each 'valley.' Recognizing the sequence can be decomposed is hard to observe for a beginner.",
        nonObviousTransitions: "Decomposing the sequence into blocks of increasing size (e.g., $1, 2, 1$; $2, 3, 2, 1, 2, 3, 4, 3, 2, 1$)",
        techniques: "Use triangular number sums; incremental block sizes.",
        errorProneSteps: "Miscounting position, remembering the index begins at $1$.",
        solution: "Consider the sequence of positive integers $$1,2,1,2,3,2,1,2,3,4,3,2,1,2,3,4,5,4,3,2,1,2,3,4,5,6,5,4,3,2,1,2,\dots$$ What is the 2025th term?",
        options: [
            "5",
            "15",
            "16",
            "44",
            "45"
        ]
    },
    {
        id: "AMC10A_2025_P6",
        contest: "AMC 10A 2025",
        problemNumber: 6,
        difficulty: 28,
        answerIndex: 2,
        idealTime: { 
            beginner: 120, 
            intermediate: 60,
            experienced: 25
        },
        category: "Geometry",
        tags: ["Angle Chasing", "Equilateral Triangle", "Hexagon", "Isosceles Triangle"],
        coreIdeas: "Drawing an accurate diagram and looking at the right triangle.",
        nonObviousTransitions: "Recognizing that the hexagon is formed by the angles of an isosceles triangle.",
        techniques: "Focus on one triangle at a time; use angle sum and vertical angles.",
        errorProneSteps: "Assuming hexagon is equiangular (leads to 120°).",
        solution: "In an equilateral triangle each interior angle is trisected by a pair of rays. The intersection of the interiors of the middle 20°-angle at each vertex is the interior of a convex hexagon. What is the degree measure of the smallest angle of this hexagon?",
        options: [
            "80",
            "90",
            "100",
            "110",
            "120"
        ]
    },
    {
        id: "AMC10A_2025_P7",
        contest: "AMC 10A 2025",
        problemNumber: 7,
        difficulty: 18,
        answerIndex: 4,
        idealTime: { 
            beginner: 90, 
            intermediate: 40,
            experienced: 30
        },
        category: "Algebra",
        tags: ["Polynomials", "Remainder Theorem", "System of Equations"],
        coreIdeas: "Applying the remainder theorem.",
        nonObviousTransitions: "N/A",
        techniques: "Plugging and chugging once the theorem is directly applied.",
        errorProneSteps: "Mixing up linear expressions, arithmetic errors, extracting the incorrect result.",
        solution: "Suppose $a$ and $b$ are real numbers. When the polynomial $x^3+x^2+ax+b$ is divided by $x-1$, the remainder is $4$. When divided by $x-2$, the remainder is $6$. What is $b-a$?",
        options: [
            "14",
            "15",
            "16",
            "17",
            "18"
        ]
    },
    {
        id: "AMC10A_2025_P8",
        contest: "AMC 10A 2025",
        problemNumber: 8,
        difficulty: 13,
        answerIndex: 1,
        idealTime: { 
            beginner: 120, 
            intermediate: 60,
            experienced: 60
        },
        category: "Logic",
        tags: ["Logic Puzzle", "Truth Statements", "Casework"],
        coreIdeas: "Interpreting what it really means if a statement is true or false. Recognize that the statements can be implied off each other (i.e., statement 2 being true requires statement 1 to be true too.)",
        nonObviousTransitions: "Recognizing the implications between the statements (e.g., Statement 2 implies Statement 1).",
        techniques: "Test each scenario by number of true statements.",
        errorProneSteps: "Extracting the incorrect result, or failing to understand the problem.",
        solution: "Agnes writes the following four statements on a blank piece of paper.<ul><li>$\bullet$ At least one of these statements is true.</li><li>$\bullet$ At least two of these statements are true.</li><li>$\bullet$ At least two of these statements are false.</li><li>$\bullet$ At least one of these statements is false.</li></ul>Each statement is either true or false. How many false statements did Agnes write on the paper?",
        options: [
            "0",
            "1",
            "2",
            "3",
            "4"
        ]
    },
    {
        id: "AMC10A_2025_P9",
        contest: "AMC 10A 2025",
        problemNumber: 9,
        difficulty: 45,
        answerIndex: 2,
        idealTime: { 
            beginner: 600, 
            intermediate: 240,
            experienced: 150
        },
        category: "Algebra",
        tags: ["Functions", "Cubic", "Roots", "Transformations", "Optimization"],
        coreIdeas: "Recognizing that the condition is equivalent to asking how many $x$ satisfy $f(x)=25$. Interpreting the graph of a cubic. Solving for number of roots without directly finding them.",
        nonObviousTransitions: "Transforming $y=f(x-a)$ passing through $(1, 25)$ into $f(1-a)=25$, which means finding the number of roots for $f(x)=25$ where $x = 1-a$.",
        techniques: "Calculate maxima and minima to count intersections.",
        errorProneSteps: "Attempting exact roots unnecessarily, applying calculus, lazily assuming there are three intersection points because it is a cubic.",
        solution: "Let $f(x)=100x^3-300x^2+200x$. For how many real numbers $a$ does the graph of $y=f(x-a)$ pass through the point $(1,25)$?",
        options: [
            "1",
            "2",
            "3",
            "4",
            "more than 4"
        ]
    },

    {
        id: "AMC10A_2025_P10",
        contest: "AMC 10A 2025",
        problemNumber: 10,
        difficulty: 32,
        answerIndex: 2, // Corresponds to (B) 24\pi
        idealTime: { 
            beginner: 150, // 2-3 min
            intermediate: 90, // 1-2 min
            experienced: 40
        },
        category: "Geometry",
        tags: ["Area", "Circles", "Semicircle", "Chord", "Pythagorean Theorem"],
        coreIdeas: "Using the Pythagorean theorem to relate the radius of the larger semicircle ($R$) and the height of the chord ($r$, which is the radius of the smaller semicircle).",
        nonObviousTransitions: "Recognize that the radius of the smaller semicircle, $r$, is the distance from the center to the chord $\\overline{CD}$.",
        techniques: "Set up the area as $A_{large} - A_{small}$ and simplify the resulting expression using the geometric relationship $R^2 - r^2 = 8^2$.",
        errorProneSteps: "Failing to divide the area by two (semicircle vs. circle). Adding the areas of the semicircles instead of subtracting.",
        solution: "A semicircle has diameter $\\overline{AB}$ and chord $\\overline{CD}$ of length $16$ parallel to $\\overline{AB}$. A smaller semicircle with diameter on $\\overline{AB}$ and tangent to $\\overline{CD}$ is cut from the larger semicircle, as shown below. What is the area of the resulting figure, shown shaded?",
        options: [
            "$16\\pi$",
            "$24\\pi$",
            "$32\\pi$",
            "$48\\pi$",
            "$64\\pi$"
        ]
    },
    {
        id: "AMC10A_2025_P11",
        contest: "AMC 10A 2025",
        problemNumber: 11,
        difficulty: 23,
        answerIndex: 4, // Corresponds to (C) 103
        idealTime: { 
            beginner: 210, // 3-4 min
            intermediate: 90, // 1.5 min
            experienced: 45
        },
        category: "Algebra",
        tags: ["Arithmetic Sequence", "Geometric Sequence", "Number Theory", "Trial and Error"],
        coreIdeas: "Expressing the terms in both sequences using common difference $d$ and common ratio $r$, and solving the resulting equations for the smallest integer $z$.",
        nonObviousTransitions: "The key is realizing the terms must be $1, 1+d, 1+2d, 1+3d$ and $1, r, r^2, r^3$. Since all are integers, $r$ must be an integer, and $r^3 = 1+3d$.",
        techniques: "Systematic trial and error with integer values for the common ratio $r$, checking the condition $r^3-1 = 3d$ where $d$ must be a positive integer.",
        errorProneSteps: "Finding an incorrect value of $z$ (e.g., the next possible $z$) or incorrectly summing the final values.",
        solution: "The sequence $1, x, y, z$ is arithmetic. The sequence $1, p, q, z$ is geometric. Both sequences are strictly increasing and contain only integers, and $z$ is as small as possible. What is the value of $x+y+z+p+q$?",
        options: [
            "66",
            "91",
            "103",
            "132",
            "149"
        ]
    },
    {
        id: "AMC10A_2025_P12",
        contest: "AMC 10A 2025",
        problemNumber: 12,
        difficulty: 35,
        answerIndex: 3, // Corresponds to (B) 192
        idealTime: { 
            beginner: 300, // 5 min
            intermediate: 150, // 2.5 min
            experienced: 90 // 1.5 min
        },
        category: "Combinatorics",
        tags: ["Casework", "Constructive Counting", "Parity", "Prime Numbers"],
        coreIdeas: "The only digit that is both even and prime (from $1$ to $9$) is $2$. This splits the problem into two distinct cases: the passcode contains $2$, or it does not.",
        nonObviousTransitions: "Correctly defining the three sets of digits: **Set E** (Even & Not Prime: {4, 6, 8}), **Set P** (Odd & Prime: {3, 5, 7}), and **Set N** (Odd & Not Prime: {1, 9}). The digit **2** must be handled separately.",
        techniques: "Constructive counting using casework (Case 1: $2$ is a digit; Case 2: $2$ is not a digit). Use the multiplication principle for each case.",
        errorProneSteps: "Failing to account for the position of the special digits. Incorrectly computing the number of options for each case.",
        solution: "Carlos uses a $4$-digit passcode to unlock his computer. In his passcode, exactly one digit is even, exactly one (possibly different) digit is prime, and no digit is $0$. How many $4$-digit passcodes satisfy these conditions?",
        options: [
            "176",
            "192",
            "432",
            "464",
            "608"
        ]
    },
    {
        id: "AMC10A_2025_P13",
        contest: "AMC 10A 2025",
        problemNumber: 13,
        difficulty: 36,
        answerIndex: 3, // Corresponds to (D) 3/4
        idealTime: { 
            beginner: 240, // 4 min
            intermediate: 120, // 2 min
            experienced: 90 // 1-2 min
        },
        category: "Geometry",
        tags: ["Geometric Series", "Area", "Similarity", "Infinite Sums", "Ratio"],
        coreIdeas: "The areas of the successively smaller squares form an **infinite geometric series** with a common ratio related to $k$. The shaded area is the sum of the areas of the odd-numbered annuli (differences of square areas).",
        nonObviousTransitions: "The ratio of the areas of successive squares is $k^2$, not $k$. Expressing the shaded area as a geometric series.",
        techniques: "Use the formula for the sum of an infinite geometric series: $S = \\frac{a}{1-r}$. Set up the equation for the shaded area being $0.64$ of the total area.",
        errorProneSteps: "Incorrectly finding the value of the common ratio in the area series (using $k$ instead of $k^2$). Incorrectly summing the shaded/unshaded portions.",
        solution: "In the figure below, the outside square contains infinitely many squares, each of them with the same center and sides parallel to the outside square. The ratio of the side length of a square to the side length of the next inner square is $k$, where $0 < k < 1$. The spaces between squares are alternately shaded as shown in the figure. The area of the shaded portion of the figure is $64\\%$ of the area of the original square. What is $k$?",
        options: [
            "\\frac{3}{5}",
            "\\frac{16}{25}",
            "\\frac{2}{3}",
            "\\frac{3}{4}",
            "\\frac{4}{5}"
        ]
    }
    // Add P10-P25 data here when available
];
        // --- TOPIC MAPPING ---
        const curriculum = [
            { id: "algebra", title: "Algebra & Number Theory", problems: ["AMC10A_2025_P1", "AMC10A_2025_P2", "AMC10A_2025_P4", "AMC10A_2025_P5", "AMC10A_2025_P7", "AMC10A_2025_P11", "AMC10A_2025_P9"] },
            { id: "geometry", title: "Geometry & Spatial", problems: ["AMC10A_2025_P3", "AMC10A_2025_P6", "AMC10A_2025_P10", "AMC10A_2025_P13"] },
            { id: "combo", title: "Combinatorics & Logic", problems: ["AMC10A_2025_P8", "AMC10A_2025_P12"] }
        ];

        // --- DIFFICULTY HELPERS (8-TIER SCALE) ---
        function getDiffData(d) {
            if (d <= 10) return { class: 'veasy', label: 'Very Easy', rowClass: 'row-veasy' };
            if (d <= 20) return { class: 'easy', label: 'Easy', rowClass: 'row-easy' };
            if (d <= 35) return { class: 'easymed', label: 'Easy-Med', rowClass: 'row-easymed' };
            if (d <= 50) return { class: 'med', label: 'Medium', rowClass: 'row-med' };
            if (d <= 65) return { class: 'medhard', label: 'Med-Hard', rowClass: 'row-medhard' };
            if (d <= 80) return { class: 'hard', label: 'Hard', rowClass: 'row-hard' };
            if (d <= 90) return { class: 'vhard', label: 'V. Hard', rowClass: 'row-vhard' };
            return { class: 'extreme', label: 'Extreme', rowClass: 'row-extreme' };
        }

        // --- RENDERING ---
        function renderApp() {
            renderGuide();
            lucide.createIcons();
            if(window.MathJax) MathJax.typesetPromise();
        }

        function renderGuide() {
            const container = document.getElementById('guideContent');
            if (!container) return;
            
            container.innerHTML = curriculum.map(section => {
                const sectionProbs = section.problems.map(pid => problems.find(p => p.id === pid)).filter(Boolean);
                
                return `
                <div class="topic-section" id="topic-${section.id}">
                    <div class="topic-header">
                        <i data-lucide="book-open" class="topic-icon"></i>
                        ${section.title}
                    </div>
                    <div class="problem-list">
                        ${sectionProbs.map(p => {
                            const isSolved = solvedProblems.has(p.id);
                            const diffData = getDiffData(p.difficulty);
                            
                            return `
                            <div class="problem-row ${diffData.rowClass}" onclick="window.openDetail('${p.id}')">
                                <div class="status-icon ${isSolved ? 'solved' : ''}">
                                    ${isSolved ? '<i data-lucide="check-circle-2"></i>' : '<i data-lucide="circle"></i>'}
                                </div>
                                <div class="prob-info">
                                    <span class="prob-title">#${p.problemNumber} ${p.topic.charAt(0).toUpperCase() + p.topic.slice(1)}</span>
                                    <div class="prob-tags-col">
                                        ${p.tags.slice(0,3).map(t => `<span class="mini-tag">${t}</span>`).join('')}
                                    </div>
                                </div>
                                <div class="diff-badge badge-${diffData.class}">
                                    ${diffData.label}
                                </div>
                                <div style="color:#444"><i data-lucide="chevron-right"></i></div>
                            </div>
                            `
                        }).join('')}
                    </div>
                </div>
                `;
            }).join('');
        }

        // --- WINDOW FUNCTIONS ---
        window.switchView = (viewName) => {};
        window.scrollToTopic = (id) => {
            document.querySelectorAll('.guide-nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`topic-${id}`)?.scrollIntoView({ behavior: 'smooth' });
        };

        window.openDetail = (id) => {
            const p = problems.find(x => x.id === id);
            if(!p) return;

            const diffData = getDiffData(p.difficulty);

            const optionsHtml = p.options.map((opt, i) => `
                <div class="opt-box" onclick="window.checkAnswer('${p.id}', ${i}, this)">
                    <span style="color:#666; font-weight:bold;">${String.fromCharCode(65+i)}</span>
                    <span>${opt}</span>
                </div>
            `).join('');

            document.getElementById('detailContent').innerHTML = `
                <div class="question-header">
                    <div>
                        <h2 style="margin:0; font-size: 1.8rem; margin-bottom: 5px;">Problem ${p.problemNumber}</h2>
                        <span style="color:#888;">${p.contest} • <span class="diff-badge badge-${diffData.class}" style="display:inline-block">${diffData.label}</span> (${p.difficulty})</span>
                    </div>
                    <div style="font-size:2.5rem; font-weight:800; color:#222;">#${p.problemNumber}</div>
                </div>

                <div class="question-box">${p.solution}</div>
                
                <div class="options-grid" id="optGrid">${optionsHtml}</div>

                <div class="analysis-dashboard">
                    <div class="info-card">
                        <h4><i data-lucide="clock"></i> Ideal Time</h4>
                        <div style="color: #ccc; font-size: 0.9rem;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Beginner:</span> <b>${p.idealTime.beginner}s</b></div>
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Intermediate:</span> <b>${p.idealTime.intermediate}s</b></div>
                            <div style="display:flex; justify-content:space-between;"><span>Experienced:</span> <b>${p.idealTime.experienced}s</b></div>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h4><i data-lucide="tag"></i> Core Ideas</h4>
                        <p style="color:#ccc; font-size:0.95rem; line-height:1.6;">${p.coreIdeas}</p>
                    </div>

                    <div class="info-card trap-card">
                        <h4><i data-lucide="alert-triangle"></i> Common Trap</h4>
                        <p style="color:#ccc; font-size:0.95rem; line-height:1.6;">${p.errorProneSteps}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('detailOverlay').classList.remove('hidden');
            lucide.createIcons();
            if(window.MathJax) MathJax.typesetPromise();
        };

        window.checkAnswer = (pid, idx, el) => {
            const p = problems.find(x => x.id === pid);
            const grid = document.getElementById('optGrid');
            
            // Disable clicks
            grid.style.pointerEvents = 'none';
            grid.querySelectorAll('.opt-box').forEach(b => b.classList.add('disabled'));

            if(idx === p.answerIndex) {
                el.classList.add('correct');
                saveProgress(pid, p.difficulty);
            } else {
                el.classList.add('incorrect');
                grid.children[p.answerIndex].classList.add('correct');
            }
        };

        window.closeDetail = () => {
            document.getElementById('detailOverlay').classList.add('hidden');
        };

        // --- FIRESTORE LOGIC ---
        async function loadProgress() {
            if(!currentUser || !db) return;
            const userRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'profile', 'data');
            try {
                const snap = await getDoc(userRef);
                if (snap.exists()) {
                    const data = snap.data();
                    solvedProblems = new Set(data.solved || []);
                    currentXP = data.xp || 0;
                    document.getElementById('userXp').innerText = `${currentXP} XP`;
                    document.getElementById('solvedCount').innerText = solvedProblems.size;
                } else {
                    await setDoc(userRef, { solved: [], xp: 0 });
                }
            } catch (e) { console.error("Load error:", e); }
        }

        async function saveProgress(problemId, difficulty) {
            solvedProblems.add(problemId);
            const xpGain = Math.max(10, difficulty);
            currentXP += xpGain;

            // UI Update
            document.getElementById('userXp').innerText = `${currentXP} XP`;
            document.getElementById('solvedCount').innerText = solvedProblems.size;
            renderApp();

            // Cloud Save
            if(!currentUser || !db) return;
            const userRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'profile', 'data');
            try {
                await updateDoc(userRef, { solved: arrayUnion(problemId), xp: currentXP });
            } catch (e) { console.error("Save error:", e); }
        }

        // --- INIT ---
        const initFirebase = async () => {
            renderApp(); // RENDER IMMEDIATELY
            if (typeof __firebase_config !== 'undefined') {
                try {
                    const firebaseConfig = JSON.parse(__firebase_config);
                    app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);

                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            currentUser = user;
                            document.getElementById('loginText').innerText = "User " + user.uid.substring(0,4);
                            await loadProgress();
                        }
                        renderApp();
                    });

                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (e) { console.log("Offline mode active."); }
            }
        };

        initFirebase();

    </script>
</body>
</html>
